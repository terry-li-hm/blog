---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import LayoutChiri from "@/layouts/LayoutChiri.astro";
import HeaderChiri from "@/components/HeaderChiri.astro";
import FooterChiri from "@/components/FooterChiri.astro";
import CardChiri from "@/components/CardChiri.astro";
import PaginationChiri from "@/components/PaginationChiri.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import { SITE } from "@/config";

export const getStaticPaths = (async ({ paginate }) => {
  const posts = await getCollection("blog", ({ data }) => !data.draft);
  return paginate(getSortedPosts(posts), { pageSize: SITE.postPerPage });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<LayoutChiri title={`Posts | ${SITE.title}`}>
  <HeaderChiri />
  <main class="main-content">
    <section class="posts-header">
      <h1>Posts</h1>
      <p class="posts-desc">All the articles I've posted.</p>
    </section>
    
    <ul class="post-list">
      {page.data.map(data => <CardChiri data={data} />)}
    </ul>

    <PaginationChiri {page} />
  </main>
  <FooterChiri />
</LayoutChiri>

<style>
  .main-content {
    max-width: 48rem;
    margin: 0 auto;
    padding: 0 1rem;
    min-height: calc(100vh - 12rem);
  }

  .posts-header {
    margin-bottom: 3rem;
  }

  .posts-header h1 {
    font-size: 2rem;
    font-weight: 500;
    margin-bottom: 1rem;
    color: var(--foreground);
  }

  .posts-desc {
    font-size: 0.9375rem;
    color: var(--text-secondary);
    line-height: 1.6;
  }

  .post-list {
    list-style: none;
    padding: 0;
    margin: 0 0 3rem 0;
  }

  @media (max-width: 640px) {
    .posts-header h1 {
      font-size: 1.5rem;
    }

    .posts-desc {
      font-size: 0.875rem;
    }
  }
</style>